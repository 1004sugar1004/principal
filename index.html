<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026, ìƒˆë¡œìš´ ì‹œì‘ - ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜ê»˜</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- html2canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Nanum Myeongjo', serif;
        }

        #app {
            position: relative;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('https://i.imgur.com/ccQbw2H.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: white;
        }

        /* Animations */
        @keyframes fall {
            to { transform: translateY(110vh) rotate(360deg); }
        }
        @keyframes swing {
            0%, 100% { transform: translateX(-50%) rotate(-3deg); }
            50% { transform: translateX(-50%) rotate(3deg); }
        }
        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.8); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Snowflake */
        .snowflake {
            position: fixed;
            top: -20px;
            color: white;
            opacity: 0.8;
            pointer-events: none;
            z-index: 1;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }

        /* Controls */
        #music-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            backdrop-filter: blur(5px);
            font-size: 1.2rem;
        }
        #music-btn.playing {
            background: rgba(255, 255, 255, 0.4);
        }

        #gallery-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 90;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            display: none; /* Hidden initially */
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-family: 'Nanum Myeongjo', serif;
        }

        /* Main Content */
        #main-container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 0 10px;
            box-sizing: border-box;
            transition: filter 0.5s ease;
        }
        #main-container.blurred {
            filter: blur(5px);
        }

        .header-text {
            flex-shrink: 0;
            margin-bottom: 0;
            text-align: center;
            z-index: 40;
            margin-top: 20px;
        }
        .header-text h1 {
            font-size: clamp(1.8em, 4vw, 2.5em);
            font-weight: 700;
            color: #f3f4f6;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
            margin: 0 0 10px 0;
            letter-spacing: 2px;
        }
        .header-text p {
            font-size: clamp(0.9em, 2vw, 1.1em);
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            margin: 0;
            font-weight: 400;
        }

        /* Ornaments Area */
        #ornaments-area {
            position: relative;
            height: 80vh;
            aspect-ratio: 0.7;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            margin-top: -1vh;
        }

        .ornament {
            position: absolute;
            width: clamp(55px, 9vh, 80px);
            height: clamp(55px, 9vh, 80px);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateX(-50%);
            z-index: 30;
            /* Animation set via JS for delay */
        }
        .ornament.hidden {
            display: none;
        }

        /* Gift Box CSS inside Ornament */
        .gift-box {
            position: relative; width: 50%; height: 45%; display: flex; flex-direction: column;
            align-items: center; justify-content: flex-end; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
        }
        .gift-lid {
            position: absolute; top: 10%; width: 110%; height: 25%; border-radius: 4px; z-index: 3;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .gift-ribbon-top {
            position: absolute; top: -15%; width: 40%; height: 25%; display: flex; justify-content: center; z-index: 4;
        }
        .ribbon-loop-left { width: 50%; height: 100%; background: #ffeb3b; border-radius: 50% 0 0 50%; transform: rotate(-10deg); }
        .ribbon-loop-right { width: 50%; height: 100%; background: #ffeb3b; border-radius: 0 50% 50% 0; transform: rotate(10deg); }
        .ribbon-center { position: absolute; top: 20%; width: 20%; height: 80%; background: #fdd835; border-radius: 2px; }
        .gift-body {
            width: 100%; height: 75%; border-radius: 0 0 4px 4px; position: relative;
            box-shadow: inset 0 -5px 10px rgba(0,0,0,0.1);
        }
        .ribbon-vertical { position: absolute; left: 50%; top: 0; transform: translateX(-50%); width: 20%; height: 100%; background: #ffeb3b; }

        /* Light effects */
        .light {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 0 8px #fff;
            z-index: 20;
            opacity: 0.8;
        }

        /* Modals */
        #modal-overlay, #gallery-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            display: none; /* Flex when active */
            justify-content: center; align-items: center;
            z-index: 100; padding: 20px; box-sizing: border-box;
        }
        #gallery-overlay {
            background: rgba(0, 0, 0, 0.95);
            z-index: 200;
        }

        /* Message Modal Content */
        .modal-content {
            position: relative; background: #fffcf5; padding: 40px 30px; border-radius: 4px;
            max-width: 500px; width: 100%; text-align: center; color: #1a1a1a;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.5s ease; border: 1px solid #dcdcdc;
            box-sizing: border-box;
        }
        .modal-icon { fontSize: 2em; margin-bottom: 15px; color: #b8860b; }
        .modal-title {
            font-size: 1.4em; fontWeight: 700; margin-bottom: 25px; color: #1a1a1a;
            border-bottom: 1px solid #eee; padding-bottom: 15px; margin-top: 0;
        }
        .modal-text {
            font-size: 1.15em; line-height: 1.8; margin-bottom: 30px; color: #374151;
            white-space: pre-line; text-align: left; word-break: keep-all; padding: 10px;
        }
        .modal-btn {
            background: #1a1a1a; color: white; border: none; padding: 12px 30px; border-radius: 0;
            font-size: 1em; cursor: pointer; transition: all 0.2s ease; font-family: 'Nanum Myeongjo', serif;
        }

        /* Gallery Content */
        .gallery-content {
            background: #fff; padding: 30px; border-radius: 4px; width: 100%; max-width: 600px;
            max-height: 80vh; overflow-y: auto; display: flex; flex-direction: column; align-items: center;
            box-sizing: border-box;
        }
        .gallery-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; width: 100%;
        }
        .gallery-item {
            background: #f3f4f6; padding: 20px; cursor: pointer; text-align: center; border: 1px solid #e5e7eb;
            transition: all 0.2s; font-family: 'Nanum Myeongjo', serif;
        }
        .gallery-item:hover { background: #e5e7eb; }
        
        /* Gallery Detail View */
        .gallery-detail-container {
            display: flex; flex-direction: column; align-items: center; width: 100%;
        }
        #letter-card {
            background: #fffcf5; padding: 50px; max-width: 450px; width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5); position: relative; border: 1px solid #dcdcdc;
            box-sizing: border-box;
        }
        .card-icon { position: absolute; top: 20px; right: 20px; font-size: 1.5em; opacity: 0.5; }
        .card-title {
            color: #1a1a1a; margin-bottom: 30px; border-bottom: 1px solid #1a1a1a;
            padding-bottom: 15px; text-align: center; font-family: 'Nanum Myeongjo', serif;
            font-size: 1.5em; margin-top: 0;
        }
        .card-text {
            white-space: pre-line; line-height: 2; color: #374151; font-size: 1.1em;
            font-family: 'Nanum Myeongjo', serif; text-align: justify;
        }
        .card-footer {
            margin-top: 40px; text-align: right; color: #6b7280; font-size: 0.9em; font-style: italic;
        }
        .action-btns { display: flex; gap: 10px; margin-top: 20px; }
        .btn-dark { padding: 12px 25px; border: none; background: #1a1a1a; color: white; cursor: pointer; font-family: 'Nanum Myeongjo', serif; }
        .btn-outline { padding: 12px 25px; border: 1px solid #fff; background: transparent; color: white; cursor: pointer; font-family: 'Nanum Myeongjo', serif; }

    </style>
</head>
<body>

<div id="app">
    <audio id="bgm" loop preload="auto" src="https://ik.imagekit.io/foefnjeua/jazz-christmas-432315.mp3"></audio>

    <div id="snowflakes-container"></div>
    <div id="lights-container"></div>

    <button id="music-btn" onclick="toggleMusic()">ğŸ”‡</button>
    <button id="gallery-btn" onclick="openGallery()">ğŸ’Œ í¸ì§€í•¨ ì—´ê¸°</button>

    <div id="main-container">
        <div class="header-text">
            <h1>2026, ìƒˆë¡œìš´ ì‹œì‘</h1>
            <p>ì˜¤ë„ˆë¨¼íŠ¸ë¥¼ ëˆŒëŸ¬ <span id="user-name-display">ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜</span>ê»˜ ë“œë¦¬ëŠ” ì§€í˜œì™€ ì¶•ë³µì„ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <div id="ornaments-area">
            <!-- Ornaments will be injected here via JS -->
        </div>
    </div>

    <!-- Message Modal -->
    <div id="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-icon">ğŸ</div>
            <h2 class="modal-title" id="modal-title">To. ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜</h2>
            <div class="modal-text" id="modal-text"></div>
            <button class="modal-btn" onclick="closeModal()">ë§ˆìŒì— ìƒˆê¸°ê² ìŠµë‹ˆë‹¤ ğŸ™</button>
        </div>
    </div>

    <!-- Gallery Overlay -->
    <div id="gallery-overlay">
        <!-- Gallery Grid View -->
        <div id="gallery-grid-view" class="gallery-content">
            <h2 style="margin-bottom: 20px; color: #1a1a1a; font-family: 'Nanum Myeongjo', serif;">ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜ì˜ ì„œì¬</h2>
            <div class="gallery-grid" id="gallery-grid">
                <!-- Grid items injected JS -->
            </div>
            <button class="modal-btn" style="background: white; color: #1a1a1a; border: 1px solid #d1d5db; margin-top: 25px;" onclick="closeGallery()">ë‹«ê¸°</button>
        </div>

        <!-- Gallery Detail View -->
        <div id="gallery-detail-view" class="gallery-detail-container" style="display: none;">
            <div id="letter-card">
                <div class="card-icon">ğŸ</div>
                <h3 class="card-title">To. ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜</h3>
                <div class="card-text" id="detail-text"></div>
                <div class="card-footer">2025ë…„ ê²¨ìš¸, êµì¥ì„ ìƒë‹˜ì„ ì¡´ê²½í•˜ëŠ” ë§ˆìŒì„ ë‹´ì•„</div>
            </div>
            <div class="action-btns">
                <button class="btn-dark" onclick="saveImage()">ì´ë¯¸ì§€ë¡œ ì €ì¥ ğŸ“¸</button>
                <button class="btn-outline" onclick="showGalleryGrid()">ëª©ë¡ìœ¼ë¡œ</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- Data & State ---
    const userName = 'ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜';
    const principalMessages = [
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì§€ë‚œ ì‹œê°„ í•™êµë¥¼ ìœ„í•´ ìŸìœ¼ì‹  ì—´ì •ì— ê¹Šì´ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. \n2026ë…„ì€ ë¬´ê±°ìš´ ì±…ì„ê°ì„ ì ì‹œ ë‚´ë ¤ë†“ê³ , ê·¸ ë¹ˆ ê³µê°„ì— ìƒˆë¡œìš´ í¬ë§ê³¼ í‰ì•ˆì´ ê¹ƒë“œëŠ” í•œ í•´ê°€ ë˜ì‹œê¸¸ ì†Œë§í•©ë‹ˆë‹¤. \nê²¨ìš¸ì´ ì§€ë‚˜ ë´„ì´ ì˜¤ë“¯, ì„ ìƒë‹˜ì˜ ë§ˆìŒì—ë„ ë”°ìŠ¤í•œ íœ´ì‹ì´ ì°¾ì•„ì˜¤ê¸¸ ê¸°ë„í•©ë‹ˆë‹¤. ğŸ`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ìˆ˜ë§ì€ ê²°ì • ì†ì—ì„œ ê³ ë‡Œí•˜ì…¨ì„ ê·¸ ë§ˆìŒì„ í—¤ì•„ë ¤ë´…ë‹ˆë‹¤. \nìƒˆí•´ì—ëŠ” ì„ ìƒë‹˜ì˜ ë§ì”€ì´ ê¸¸ì¡ì´ê°€ ë˜ê³ , ì„ ìƒë‹˜ì˜ ê·€ê°€ ì €í¬ì˜ ì•ˆì‹ì²˜ê°€ ë˜ê¸°ë¥¼ ê¸°ëŒ€í•´ë´…ë‹ˆë‹¤. \nì„œë¡œì˜ ì‘ì€ ëª©ì†Œë¦¬ì—ë„ ê·€ ê¸°ìš¸ì¼ ë•Œ í”¼ì–´ë‚˜ëŠ” ë”°ëœ»í•œ ë³€í™”ë¥¼ ì„ ìƒë‹˜ê³¼ í•¨ê»˜ ê¿ˆê¾¸ê³  ì‹¶ìŠµë‹ˆë‹¤. ğŸ‘‚`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, í•™êµì˜ ê°€ì¥ ë†’ì€ ê³³ì—ì„œ ë“ ë“ í•œ ë²„íŒ€ëª©ì´ ë˜ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. \në‹¤ê°€ì˜¤ëŠ” í•´ì—ëŠ” ì„ ìƒë‹˜ê»˜ì„œ ë¹„ì¶”ì‹œëŠ” ë”°ëœ»í•œ ë¹›ì´ ê°€ì¥ ë‚®ì€ ê³³ê¹Œì§€ ìŠ¤ë©°ë“¤ì–´, í•™êµ ì „ì²´ê°€ ì˜¨ê¸°ë¡œ ê°€ë“ ì°¨ëŠ” ê¸°ì  ê°™ì€ í•œ í•´ê°€ ë˜ê¸¸ ê¸°ë„í•©ë‹ˆë‹¤. \nì„ ìƒë‹˜ì˜ ë”°ìŠ¤í•¨ì´ ê³§ ì €í¬ì˜ í–‰ë³µì…ë‹ˆë‹¤. â˜€ï¸`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì„ ìƒë‹˜ì˜ ë„“ì€ í’ˆ ë•ë¶„ì— ì˜¬ í•œ í•´ë„ ë¬´ì‚¬íˆ ì§€ë‚˜ì™”ìŠµë‹ˆë‹¤. \n2026ë…„ì—ëŠ” ë°”ë‹¤ê°€ ëª¨ë“  ê°•ë¬¼ì„ í’ˆë“¯, ë‹¤ì–‘í•œ ì´ì•¼ê¸°ë“¤ì„ ë¯¸ì†Œë¡œ ì•ˆì•„ì£¼ì‹œëŠ” ë„‰ë„‰í•¨ ì†ì—ì„œ ì„ ìƒë‹˜ ë˜í•œ ë” í° ì¡´ê²½ê³¼ ì‚¬ë‘ì„ ë°›ìœ¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤. \nê¹Šê³  í‘¸ë¥¸ ë°”ë‹¤ ê°™ì€ í‰ì˜¨ì´ í•¨ê»˜í•˜ê¸¸ ë¹•ë‹ˆë‹¤. ğŸŒŠ`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ê·¸ë™ì•ˆ ì •ë§ ì¹˜ì—´í•˜ê²Œ ë‹¬ë ¤ì˜¤ì…¨ìŠµë‹ˆë‹¤. \nìƒˆí•´ì—ëŠ” ì¡°ê¸ˆ ë” ì—¬ìœ ë¡œìš´ ë°œê±¸ìŒìœ¼ë¡œ ì£¼ë³€ì˜ í’ê²½ë„ ë‘˜ëŸ¬ë³´ì‹œëŠ” ì‰¼ì´ ìˆìœ¼ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. \në•Œë¡œëŠ” ê°•í•¨ë³´ë‹¤ ë¶€ë“œëŸ¬ì›€ì´ ë” í° ìš¸ë¦¼ì„ ì£¼ë“¯, ì„ ìƒë‹˜ì˜ ì˜¨í™”í•œ ë¯¸ì†Œ í•œ ë²ˆì´ ì €í¬ì—ê²ŒëŠ” ê°€ì¥ í° ìœ„ë¡œê°€ ë©ë‹ˆë‹¤. ğŸƒ`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ìƒˆí•´ ë³µ ë§ì´ ë°›ìœ¼ì„¸ìš”. \në³´ì´ì§€ ì•ŠëŠ” ê³³ì—ì„œì˜ ë…¸ê³ , ì €í¬ëŠ” ê¸°ì–µí•˜ê³  ìˆìŠµë‹ˆë‹¤. \nìƒˆí•´ì—ëŠ” íƒ€ì¸ì˜ ì‹œì„ ë³´ë‹¤ ì„ ìƒë‹˜ ìŠ¤ìŠ¤ë¡œì˜ ë§ˆìŒì— ê·€ ê¸°ìš¸ì´ë©°, ê¹Šì€ ë‚´ë©´ì˜ í‰í™”ì™€ ì§„ì •í•œ í–‰ë³µì„ ë§ˆì£¼í•˜ëŠ” ì†Œì¤‘í•œ ì‹œê°„ë“¤ì´ ê°€ë“í•˜ì‹œê¸¸ ì‘ì›í•©ë‹ˆë‹¤. ğŸ§˜â€â™‚ï¸`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì§€ë‚œ 1ë…„ ë¬´ëŒ€ ìœ„ ì£¼ì¸ê³µìœ¼ë¡œì„œ ë©‹ì§€ê²Œ ì´ëŒì–´ì£¼ì…¨ìŠµë‹ˆë‹¤. \n2026ë…„ì—ëŠ” ì„ ìƒë‹˜ê³¼ í•¨ê»˜í•˜ëŠ” êµì§ì›, í•™ìƒë“¤ì´ ë¹›ë‚  ìˆ˜ ìˆë„ë¡ ë¬µë¬µíˆ ë¹„ì¶°ì£¼ì‹œëŠ” ì€ì€í•œ ë‹¬ë¹› ê°™ì€ ë¦¬ë”ì‹­ìœ¼ë¡œ ì €í¬ ê³ì— ë¨¸ë¬¼ëŸ¬ ì£¼ì‹œê¸¸ ì†Œë§í•©ë‹ˆë‹¤. \ní•¨ê»˜ ë¹›ë‚  ë•Œ ë” ì•„ë¦„ë‹¤ìš´ ìš°ë¦¬ í•™êµê°€ ë  ê²ƒì…ë‹ˆë‹¤. ğŸŒ¸`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì¢‹ì€ ë¦¬ë” ê³ì—ëŠ” ì¢‹ì€ í–¥ê¸°ê°€ ë¨¸ë¬¸ë‹¤ê³  í•©ë‹ˆë‹¤. \nêµì¥ì„ ìƒë‹˜ì˜ ì¸í’ˆì´ ê·¸ìœ½í•œ í–¥ê¸°ê°€ ë˜ì–´ í•™êµ ê³³ê³³ì— ë°°ì–´ë“¤ê¸°ë¥¼, ê·¸ë¦¬í•˜ì—¬ ì„ ìƒë‹˜ ê³ì— ë¨¸ë¬´ëŠ” ê²ƒë§Œìœ¼ë¡œë„ í–‰ë³µí•´ì§€ëŠ” 2026ë…„ì´ ë˜ê¸°ë¥¼ ê¿ˆê¿”ë´…ë‹ˆë‹¤. \nì„ ìƒë‹˜ì˜ í–¥ê¸°ë¡œ ê°€ë“ ì°° ìƒˆí•´ë¥¼ ê¸°ëŒ€í•©ë‹ˆë‹¤. âœ¨`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ê°•í•¨ë³´ë‹¤ ë” í° í˜ì€ ë¶€ë“œëŸ¬ì›€ì— ìˆë‹¤ê³  í•©ë‹ˆë‹¤. \nì§€ë‚œ í•œ í•´ ê°•ê±´í•˜ê²Œ í•™êµë¥¼ ì§€í‚¤ì…¨ë‹¤ë©´, ìƒˆí•´ì—ëŠ” ì»¤ë‹¤ë€ ë‚˜ë¬´ ê·¸ëŠ˜ì²˜ëŸ¼ ëˆ„êµ¬ë‚˜ ì°¾ì•„ì™€ ì‰´ ìˆ˜ ìˆëŠ” ë„‰ë„‰í•˜ê³  í¬ê·¼í•œ í’ˆì´ ë˜ì–´ì£¼ì‹œê¸¸ ê¸°ëŒ€í•©ë‹ˆë‹¤. \nì„ ìƒë‹˜ì˜ ê·¸ëŠ˜ ì•„ë˜ì„œ ëª¨ë‘ê°€ í–‰ë³µí•˜ê¸¸ ë°”ëë‹ˆë‹¤. ğŸŒ³`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì‹œê°„ì´ íë¥¼ìˆ˜ë¡ ë” ê¹Šì–´ì§€ëŠ” ì§€í˜œë¥¼ ì¡´ê²½í•©ë‹ˆë‹¤. \nê³ ê°œ ìˆ™ì—¬ ì•„ì´ë“¤ì˜ ëˆˆë†’ì´ë¥¼ ë§ì¶°ì£¼ì‹œëŠ” ì„ ìƒë‹˜ì˜ ë”°ëœ»í•œ ëª¨ìŠµì—ì„œ, ì €í¬ëŠ” ì§„ì •í•œ ì–´ë¥¸ì˜ í’ˆê²©ì„ ë°°ì›ë‹ˆë‹¤. \në‚´ë…„ì—ë„ ê·¸ ë”°ìŠ¤í•¨ìœ¼ë¡œ ì €í¬ë¥¼ ê°ì‹¸ì£¼ì„¸ìš”. ğŸŒ¾`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì°¨ê°€ìš´ ë¨¸ë¦¬ë³´ë‹¤ ëœ¨ê±°ìš´ ê°€ìŠ´ì´ ì‚¬ëŒì„ ì›€ì§ì¸ë‹¤ê³  í•˜ì£ . \nêµì¥ì„ ìƒë‹˜ì˜ ì§„ì‹¬ ì–´ë¦° ê³µê°ê³¼ ë”°ëœ»í•œ ìœ„ë¡œ í•œë§ˆë””ê°€ 2026ë…„ ìš°ë¦¬ í•™êµë¥¼ ë”ìš± ì‚¬ë‘ ë„˜ì¹˜ëŠ” ê³³ìœ¼ë¡œ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤. \në§ˆìŒê³¼ ë§ˆìŒì´ ë‹¿ëŠ” ê°ë™ì˜ í•œ í•´ê°€ ë˜ê¸¸ ì†Œë§í•©ë‹ˆë‹¤. ğŸ”¥`,
        `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! 1ë…„ ë™ì•ˆ ìŒ“ì•„ì˜¤ì‹  ìˆ˜ë§ì€ ì—…ì ë“¤, ì •ë§ ìˆ˜ê³  ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤. \nìƒˆí•´ì—ëŠ” ê·¸ ê²°ì‹¤ì„ í•¨ê»˜ ë‚˜ëˆ„ë©° ë” í¬ê²Œ ì›ƒëŠ” ê¸°ì¨ì„ ëˆ„ë¦¬ì‹œê¸¸ ë°”ëë‹ˆë‹¤. \në‚˜ëˆŒìˆ˜ë¡ ì»¤ì§€ê³ , ë¹„ìš¸ìˆ˜ë¡ ì±„ì›Œì§€ëŠ” í–‰ë³µì˜ ë¹„ë°€ì„ ë§Œë½í•˜ëŠ” í’ìš”ë¡œìš´ í•œ í•´ ë˜ì„¸ìš”. ğŸ`
    ];

    const ornamentStyles = [
        { color: 'rgba(255, 215, 0, 0.4)', glow: '#FFD700' },
        { color: 'rgba(224, 255, 255, 0.4)', glow: '#E0FFFF' },
        { color: 'rgba(255, 105, 180, 0.4)', glow: '#FF69B4' },
        { color: 'rgba(127, 255, 212, 0.4)', glow: '#7FFFD4' },
        { color: 'rgba(255, 165, 0, 0.4)', glow: '#FFA500' },
        { color: 'rgba(221, 160, 221, 0.4)', glow: '#DDA0DD' },
        { color: 'rgba(135, 206, 235, 0.4)', glow: '#87CEEB' },
        { color: 'rgba(240, 128, 128, 0.4)', glow: '#F08080' },
        { color: 'rgba(152, 251, 152, 0.4)', glow: '#98FB98' },
        { color: 'rgba(216, 191, 216, 0.4)', glow: '#D8BFD8' },
        { color: 'rgba(255, 218, 185, 0.4)', glow: '#FFDAB9' },
        { color: 'rgba(240, 230, 140, 0.4)', glow: '#F0E68C' }
    ];

    const giftBoxColors = [
        '#e74c3c', '#2ecc71', '#f1c40f', '#e67e22', 
        '#3498db', '#9b59b6', '#ff7979', '#1abc9c',
        '#ff6b81', '#16a085', '#2980b9', '#d63031'
    ];

    const ornamentPositions = [
        { top: '16%', left: '50%' },
        { top: '24%', left: '42%' },
        { top: '26%', left: '58%' },
        { top: '34%', left: '35%' },
        { top: '36%', left: '65%' },
        { top: '40%', left: '50%' },
        { top: '48%', left: '28%' },
        { top: '50%', left: '72%' },
        { top: '54%', left: '40%' },
        { top: '56%', left: '60%' },
        { top: '64%', left: '32%' },
        { top: '66%', left: '68%' }
    ];

    let clickedOrnaments = new Set();
    let currentOrnamentIndex = null;

    // --- DOM Elements ---
    const bgm = document.getElementById('bgm');
    const musicBtn = document.getElementById('music-btn');
    const galleryBtn = document.getElementById('gallery-btn');
    const ornamentsArea = document.getElementById('ornaments-area');
    const modalOverlay = document.getElementById('modal-overlay');
    const modalText = document.getElementById('modal-text');
    const mainContainer = document.getElementById('main-container');
    const galleryOverlay = document.getElementById('gallery-overlay');
    const galleryGrid = document.getElementById('gallery-grid');
    const galleryGridView = document.getElementById('gallery-grid-view');
    const galleryDetailView = document.getElementById('gallery-detail-view');
    const detailText = document.getElementById('detail-text');
    const letterCard = document.getElementById('letter-card');

    // --- Initialization ---
    function init() {
        createSnowflakes();
        createLights();
        renderOrnaments();
    }

    // Snowflakes Generation
    function createSnowflakes() {
        const container = document.getElementById('snowflakes-container');
        for(let i=0; i<50; i++) {
            const el = document.createElement('div');
            el.className = 'snowflake';
            el.textContent = 'â„';
            const left = Math.random() * 100;
            const size = Math.random() * 15 + 10;
            const duration = Math.random() * 10 + 15;
            const delay = Math.random() * 5;
            el.style.left = `${left}%`;
            el.style.fontSize = `${size}px`;
            el.style.animation = `fall ${duration}s linear infinite`;
            el.style.animationDelay = `${delay}s`;
            container.appendChild(el);
        }
    }

    // Lights Generation
    function createLights() {
        const container = document.getElementById('lights-container');
        for(let i=0; i<40; i++) {
            const el = document.createElement('div');
            el.className = 'light';
            const top = 15 + Math.random() * 65;
            const widthSpread = (top - 10) * 0.7;
            const left = 50 + (Math.random() * widthSpread - widthSpread/2);
            el.style.left = `${left}%`;
            el.style.top = `${top}%`;
            el.style.animation = `sparkle ${1.5 + Math.random()}s ease-in-out infinite ${Math.random()}s`;
            container.appendChild(el);
        }
    }

    // Render Ornaments
    function renderOrnaments() {
        ornamentsArea.innerHTML = ''; // Clear existing
        ornamentPositions.forEach((pos, index) => {
            if (clickedOrnaments.has(index)) return; // Don't render clicked ones

            const style = ornamentStyles[index];
            const boxColor = giftBoxColors[index % giftBoxColors.length];
            
            const el = document.createElement('div');
            el.className = 'ornament';
            el.style.top = pos.top;
            el.style.left = pos.left;
            el.style.animation = `swing 4s ease-in-out infinite ${index * 0.3}s`;
            el.onclick = () => handleOrnamentClick(index);

            // Ornament HTML structure
            el.innerHTML = `
                <div style="width: 100%; height: 100%; border-radius: 50%;
                    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9) 0%, ${style.color} 40%, rgba(0,0,0,0.4) 100%);
                    box-shadow: 0 0 15px ${style.glow}; position: absolute; top:0; left:0;"></div>
                <div style="position: absolute; top: -15%; width: 10%; height: 20%; background: #b8860b; z-index: -1;"></div>
                <div style="position: absolute; width: 60%; height: 60%; display: flex; justify-content: center; align-items: center;">
                    <div class="gift-box">
                        <div class="gift-lid" style="background: linear-gradient(to right, ${boxColor}, white 50%, ${boxColor})"></div>
                        <div class="gift-ribbon-top">
                            <div class="ribbon-loop-left"></div>
                            <div class="ribbon-loop-right"></div>
                            <div class="ribbon-center"></div>
                        </div>
                        <div class="gift-body" style="background: ${boxColor}">
                            <div class="ribbon-vertical"></div>
                        </div>
                    </div>
                </div>
            `;
            ornamentsArea.appendChild(el);
        });
    }

    // --- Event Handlers ---

    function toggleMusic() {
        if (bgm.paused) {
            bgm.play().then(() => {
                musicBtn.classList.add('playing');
                musicBtn.textContent = 'ğŸ”Š';
            }).catch(e => console.log("Play error", e));
        } else {
            bgm.pause();
            musicBtn.classList.remove('playing');
            musicBtn.textContent = 'ğŸ”‡';
        }
    }

    function handleOrnamentClick(index) {
        currentOrnamentIndex = index;
        clickedOrnaments.add(index);
        
        // Show Modal
        modalText.textContent = principalMessages[index];
        modalOverlay.style.display = 'flex';
        
        // Update Gallery Button Visibility
        if (clickedOrnaments.size > 0) {
            galleryBtn.style.display = 'flex';
        }

        // Re-render ornaments (to hide clicked one)
        renderOrnaments();
    }

    function closeModal() {
        modalOverlay.style.display = 'none';
        currentOrnamentIndex = null;
    }

    function openGallery() {
        mainContainer.classList.add('blurred');
        galleryOverlay.style.display = 'flex';
        renderGalleryGrid();
        showGalleryGrid(); // Default to grid view
    }

    function closeGallery() {
        mainContainer.classList.remove('blurred');
        galleryOverlay.style.display = 'none';
    }

    function renderGalleryGrid() {
        galleryGrid.innerHTML = '';
        const clickedArray = Array.from(clickedOrnaments).sort((a,b) => a - b);
        
        clickedArray.forEach(index => {
            const item = document.createElement('div');
            item.className = 'gallery-item';
            item.innerHTML = `
                <div style="font-size: 1.5em; margin-bottom: 5px;">ğŸ“œ</div>
                <span style="font-size: 0.9em; color: #4b5563;">${index + 1}ë²ˆì§¸ ì§€í˜œ</span>
            `;
            item.onclick = () => showDetailView(index);
            galleryGrid.appendChild(item);
        });
    }

    function showGalleryGrid() {
        galleryGridView.style.display = 'flex';
        galleryDetailView.style.display = 'none';
    }

    function showDetailView(index) {
        detailText.textContent = principalMessages[index];
        galleryGridView.style.display = 'none';
        galleryDetailView.style.display = 'flex';
    }

    function saveImage() {
        html2canvas(letterCard, {
            scale: 2,
            backgroundColor: null,
            logging: false,
            useCORS: true
        }).then(canvas => {
            const image = canvas.toDataURL("image/png");
            const link = document.createElement("a");
            link.href = image;
            link.download = `Letter_for_${userName}.png`;
            link.click();
        }).catch(err => {
            console.error("Save failed", err);
            alert("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        });
    }

    // Start
    init();

</script>

</body>
</html>
