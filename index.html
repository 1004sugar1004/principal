import React, { useState, useRef, useEffect } from 'react';

export default function App() {
  const [selectedOrnament, setSelectedOrnament] = useState(null);
  const [clickedOrnaments, setClickedOrnaments] = useState(new Set());
  // ì´ë¦„ì„ ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜ìœ¼ë¡œ ê³ ì •í•˜ê³  ì…ë ¥ ë‹¨ê³„ë¥¼ ê±´ë„ˆë›°ë„ë¡ ì„¤ì •
  const [userName] = useState('ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜'); 
  const [isNameEntered] = useState(true); 
  const [isMusicPlaying, setIsMusicPlaying] = useState(false);
  const [showGallery, setShowGallery] = useState(false); 
  const [galleryViewLetter, setGalleryViewLetter] = useState(null); 
  
  const audioRef = useRef(null);
  const letterCardRef = useRef(null); 

  // Google Fonts & html2canvas ë¡œë“œ
  useEffect(() => {
    const link = document.createElement('link');
    link.href = 'https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap'; // ëª…ì¡°ì²´ë¡œ ë³€ê²½ (ë” ì¤‘í›„í•œ ëŠë‚Œ)
    link.rel = 'stylesheet';
    document.head.appendChild(link);

    const script = document.createElement('script');
    script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
    script.async = true;
    document.body.appendChild(script);

    return () => {
      document.head.removeChild(link);
      document.body.removeChild(script);
    };
  }, []);

  // ì˜¤ë””ì˜¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  useEffect(() => {
    const audio = audioRef.current;
    if (!audio) return;

    const handlePlay = () => setIsMusicPlaying(true);
    const handlePause = () => setIsMusicPlaying(false);
    const handleError = (e) => console.log("Audio Error:", e);

    audio.addEventListener('play', handlePlay);
    audio.addEventListener('pause', handlePause);
    audio.addEventListener('error', handleError);

    return () => {
      audio.removeEventListener('play', handlePlay);
      audio.removeEventListener('pause', handlePause);
      audio.removeEventListener('error', handleError);
    };
  }, []);

  const toggleMusic = () => {
    if (audioRef.current) {
      if (audioRef.current.paused) {
        audioRef.current.play().catch(error => console.log("Music play failed:", error));
      } else {
        audioRef.current.pause();
      }
    }
  };

  // êµì¥ì„ ìƒë‹˜ì„ ìœ„í•œ íŠ¹ë³„ ë©”ì‹œì§€ (ê°ë™ì ì´ê³  ì€ìœ ì ì¸ í†¤ìœ¼ë¡œ ìˆ˜ì •)
  const principalMessages = [
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì§€ë‚œ ì‹œê°„ í•™êµë¥¼ ìœ„í•´ ìŸìœ¼ì‹  ì—´ì •ì— ê¹Šì´ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. \n2026ë…„ì€ ë¬´ê±°ìš´ ì±…ì„ê°ì„ ì ì‹œ ë‚´ë ¤ë†“ê³ , ê·¸ ë¹ˆ ê³µê°„ì— ìƒˆë¡œìš´ í¬ë§ê³¼ í‰ì•ˆì´ ê¹ƒë“œëŠ” í•œ í•´ê°€ ë˜ì‹œê¸¸ ì†Œë§í•©ë‹ˆë‹¤. \nê²¨ìš¸ì´ ì§€ë‚˜ ë´„ì´ ì˜¤ë“¯, ì„ ìƒë‹˜ì˜ ë§ˆìŒì—ë„ ë”°ìŠ¤í•œ íœ´ì‹ì´ ì°¾ì•„ì˜¤ê¸¸ ê¸°ë„í•©ë‹ˆë‹¤. ğŸ`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ìˆ˜ë§ì€ ê²°ì • ì†ì—ì„œ ê³ ë‡Œí•˜ì…¨ì„ ê·¸ ë§ˆìŒì„ í—¤ì•„ë ¤ë´…ë‹ˆë‹¤. \nìƒˆí•´ì—ëŠ” ì„ ìƒë‹˜ì˜ ë§ì”€ì´ ê¸¸ì¡ì´ê°€ ë˜ê³ , ì„ ìƒë‹˜ì˜ ê·€ê°€ ì €í¬ì˜ ì•ˆì‹ì²˜ê°€ ë˜ê¸°ë¥¼ ê¸°ëŒ€í•´ë´…ë‹ˆë‹¤. \nì„œë¡œì˜ ì‘ì€ ëª©ì†Œë¦¬ì—ë„ ê·€ ê¸°ìš¸ì¼ ë•Œ í”¼ì–´ë‚˜ëŠ” ë”°ëœ»í•œ ë³€í™”ë¥¼ ì„ ìƒë‹˜ê³¼ í•¨ê»˜ ê¿ˆê¾¸ê³  ì‹¶ìŠµë‹ˆë‹¤. ğŸ‘‚`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, í•™êµì˜ ê°€ì¥ ë†’ì€ ê³³ì—ì„œ ë“ ë“ í•œ ë²„íŒ€ëª©ì´ ë˜ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. \në‹¤ê°€ì˜¤ëŠ” í•´ì—ëŠ” ì„ ìƒë‹˜ê»˜ì„œ ë¹„ì¶”ì‹œëŠ” ë”°ëœ»í•œ ë¹›ì´ ê°€ì¥ ë‚®ì€ ê³³ê¹Œì§€ ìŠ¤ë©°ë“¤ì–´, í•™êµ ì „ì²´ê°€ ì˜¨ê¸°ë¡œ ê°€ë“ ì°¨ëŠ” ê¸°ì  ê°™ì€ í•œ í•´ê°€ ë˜ê¸¸ ê¸°ë„í•©ë‹ˆë‹¤. \nì„ ìƒë‹˜ì˜ ë”°ìŠ¤í•¨ì´ ê³§ ì €í¬ì˜ í–‰ë³µì…ë‹ˆë‹¤. â˜€ï¸`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì„ ìƒë‹˜ì˜ ë„“ì€ í’ˆ ë•ë¶„ì— ì˜¬ í•œ í•´ë„ ë¬´ì‚¬íˆ ì§€ë‚˜ì™”ìŠµë‹ˆë‹¤. \n2026ë…„ì—ëŠ” ë°”ë‹¤ê°€ ëª¨ë“  ê°•ë¬¼ì„ í’ˆë“¯, ë‹¤ì–‘í•œ ì´ì•¼ê¸°ë“¤ì„ ë¯¸ì†Œë¡œ ì•ˆì•„ì£¼ì‹œëŠ” ë„‰ë„‰í•¨ ì†ì—ì„œ ì„ ìƒë‹˜ ë˜í•œ ë” í° ì¡´ê²½ê³¼ ì‚¬ë‘ì„ ë°›ìœ¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤. \nê¹Šê³  í‘¸ë¥¸ ë°”ë‹¤ ê°™ì€ í‰ì˜¨ì´ í•¨ê»˜í•˜ê¸¸ ë¹•ë‹ˆë‹¤. ğŸŒŠ`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ê·¸ë™ì•ˆ ì •ë§ ì¹˜ì—´í•˜ê²Œ ë‹¬ë ¤ì˜¤ì…¨ìŠµë‹ˆë‹¤. \nìƒˆí•´ì—ëŠ” ì¡°ê¸ˆ ë” ì—¬ìœ ë¡œìš´ ë°œê±¸ìŒìœ¼ë¡œ ì£¼ë³€ì˜ í’ê²½ë„ ë‘˜ëŸ¬ë³´ì‹œëŠ” ì‰¼ì´ ìˆìœ¼ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. \në•Œë¡œëŠ” ê°•í•¨ë³´ë‹¤ ë¶€ë“œëŸ¬ì›€ì´ ë” í° ìš¸ë¦¼ì„ ì£¼ë“¯, ì„ ìƒë‹˜ì˜ ì˜¨í™”í•œ ë¯¸ì†Œ í•œ ë²ˆì´ ì €í¬ì—ê²ŒëŠ” ê°€ì¥ í° ìœ„ë¡œê°€ ë©ë‹ˆë‹¤. ğŸƒ`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ìƒˆí•´ ë³µ ë§ì´ ë°›ìœ¼ì„¸ìš”. \në³´ì´ì§€ ì•ŠëŠ” ê³³ì—ì„œì˜ ë…¸ê³ , ì €í¬ëŠ” ê¸°ì–µí•˜ê³  ìˆìŠµë‹ˆë‹¤. \nìƒˆí•´ì—ëŠ” íƒ€ì¸ì˜ ì‹œì„ ë³´ë‹¤ ì„ ìƒë‹˜ ìŠ¤ìŠ¤ë¡œì˜ ë§ˆìŒì— ê·€ ê¸°ìš¸ì´ë©°, ê¹Šì€ ë‚´ë©´ì˜ í‰í™”ì™€ ì§„ì •í•œ í–‰ë³µì„ ë§ˆì£¼í•˜ëŠ” ì†Œì¤‘í•œ ì‹œê°„ë“¤ì´ ê°€ë“í•˜ì‹œê¸¸ ì‘ì›í•©ë‹ˆë‹¤. ğŸ§˜â€â™‚ï¸`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì§€ë‚œ 1ë…„ ë¬´ëŒ€ ìœ„ ì£¼ì¸ê³µìœ¼ë¡œì„œ ë©‹ì§€ê²Œ ì´ëŒì–´ì£¼ì…¨ìŠµë‹ˆë‹¤. \n2026ë…„ì—ëŠ” ì„ ìƒë‹˜ê³¼ í•¨ê»˜í•˜ëŠ” êµì§ì›, í•™ìƒë“¤ì´ ë¹›ë‚  ìˆ˜ ìˆë„ë¡ ë¬µë¬µíˆ ë¹„ì¶°ì£¼ì‹œëŠ” ì€ì€í•œ ë‹¬ë¹› ê°™ì€ ë¦¬ë”ì‹­ìœ¼ë¡œ ì €í¬ ê³ì— ë¨¸ë¬¼ëŸ¬ ì£¼ì‹œê¸¸ ì†Œë§í•©ë‹ˆë‹¤. \ní•¨ê»˜ ë¹›ë‚  ë•Œ ë” ì•„ë¦„ë‹¤ìš´ ìš°ë¦¬ í•™êµê°€ ë  ê²ƒì…ë‹ˆë‹¤. ğŸŒ¸`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì¢‹ì€ ë¦¬ë” ê³ì—ëŠ” ì¢‹ì€ í–¥ê¸°ê°€ ë¨¸ë¬¸ë‹¤ê³  í•©ë‹ˆë‹¤. \nêµì¥ì„ ìƒë‹˜ì˜ ì¸í’ˆì´ ê·¸ìœ½í•œ í–¥ê¸°ê°€ ë˜ì–´ í•™êµ ê³³ê³³ì— ë°°ì–´ë“¤ê¸°ë¥¼, ê·¸ë¦¬í•˜ì—¬ ì„ ìƒë‹˜ ê³ì— ë¨¸ë¬´ëŠ” ê²ƒë§Œìœ¼ë¡œë„ í–‰ë³µí•´ì§€ëŠ” 2026ë…„ì´ ë˜ê¸°ë¥¼ ê¿ˆê¿”ë´…ë‹ˆë‹¤. \nì„ ìƒë‹˜ì˜ í–¥ê¸°ë¡œ ê°€ë“ ì°° ìƒˆí•´ë¥¼ ê¸°ëŒ€í•©ë‹ˆë‹¤. âœ¨`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ê°•í•¨ë³´ë‹¤ ë” í° í˜ì€ ë¶€ë“œëŸ¬ì›€ì— ìˆë‹¤ê³  í•©ë‹ˆë‹¤. \nì§€ë‚œ í•œ í•´ ê°•ê±´í•˜ê²Œ í•™êµë¥¼ ì§€í‚¤ì…¨ë‹¤ë©´, ìƒˆí•´ì—ëŠ” ì»¤ë‹¤ë€ ë‚˜ë¬´ ê·¸ëŠ˜ì²˜ëŸ¼ ëˆ„êµ¬ë‚˜ ì°¾ì•„ì™€ ì‰´ ìˆ˜ ìˆëŠ” ë„‰ë„‰í•˜ê³  í¬ê·¼í•œ í’ˆì´ ë˜ì–´ì£¼ì‹œê¸¸ ê¸°ëŒ€í•©ë‹ˆë‹¤. \nì„ ìƒë‹˜ì˜ ê·¸ëŠ˜ ì•„ë˜ì„œ ëª¨ë‘ê°€ í–‰ë³µí•˜ê¸¸ ë°”ëë‹ˆë‹¤. ğŸŒ³`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì‹œê°„ì´ íë¥¼ìˆ˜ë¡ ë” ê¹Šì–´ì§€ëŠ” ì§€í˜œë¥¼ ì¡´ê²½í•©ë‹ˆë‹¤. \nê³ ê°œ ìˆ™ì—¬ ì•„ì´ë“¤ì˜ ëˆˆë†’ì´ë¥¼ ë§ì¶°ì£¼ì‹œëŠ” ì„ ìƒë‹˜ì˜ ë”°ëœ»í•œ ëª¨ìŠµì—ì„œ, ì €í¬ëŠ” ì§„ì •í•œ ì–´ë¥¸ì˜ í’ˆê²©ì„ ë°°ì›ë‹ˆë‹¤. \në‚´ë…„ì—ë„ ê·¸ ë”°ìŠ¤í•¨ìœ¼ë¡œ ì €í¬ë¥¼ ê°ì‹¸ì£¼ì„¸ìš”. ğŸŒ¾`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ì°¨ê°€ìš´ ë¨¸ë¦¬ë³´ë‹¤ ëœ¨ê±°ìš´ ê°€ìŠ´ì´ ì‚¬ëŒì„ ì›€ì§ì¸ë‹¤ê³  í•˜ì£ . \nêµì¥ì„ ìƒë‹˜ì˜ ì§„ì‹¬ ì–´ë¦° ê³µê°ê³¼ ë”°ëœ»í•œ ìœ„ë¡œ í•œë§ˆë””ê°€ 2026ë…„ ìš°ë¦¬ í•™êµë¥¼ ë”ìš± ì‚¬ë‘ ë„˜ì¹˜ëŠ” ê³³ìœ¼ë¡œ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤. \në§ˆìŒê³¼ ë§ˆìŒì´ ë‹¿ëŠ” ê°ë™ì˜ í•œ í•´ê°€ ë˜ê¸¸ ì†Œë§í•©ë‹ˆë‹¤. ğŸ”¥`,
    
    `ê¹€ë•ìˆ˜ êµì¥ì„ ìƒë‹˜, ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! 1ë…„ ë™ì•ˆ ìŒ“ì•„ì˜¤ì‹  ìˆ˜ë§ì€ ì—…ì ë“¤, ì •ë§ ìˆ˜ê³  ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤. \nìƒˆí•´ì—ëŠ” ê·¸ ê²°ì‹¤ì„ í•¨ê»˜ ë‚˜ëˆ„ë©° ë” í¬ê²Œ ì›ƒëŠ” ê¸°ì¨ì„ ëˆ„ë¦¬ì‹œê¸¸ ë°”ëë‹ˆë‹¤. \në‚˜ëˆŒìˆ˜ë¡ ì»¤ì§€ê³ , ë¹„ìš¸ìˆ˜ë¡ ì±„ì›Œì§€ëŠ” í–‰ë³µì˜ ë¹„ë°€ì„ ë§Œë½í•˜ëŠ” í’ìš”ë¡œìš´ í•œ í•´ ë˜ì„¸ìš”. ğŸ`
  ];

  const ornamentStyles = [
    { color: 'rgba(255, 215, 0, 0.4)', glow: '#FFD700' },
    { color: 'rgba(224, 255, 255, 0.4)', glow: '#E0FFFF' },
    { color: 'rgba(255, 105, 180, 0.4)', glow: '#FF69B4' },
    { color: 'rgba(127, 255, 212, 0.4)', glow: '#7FFFD4' },
    { color: 'rgba(255, 165, 0, 0.4)', glow: '#FFA500' },
    { color: 'rgba(221, 160, 221, 0.4)', glow: '#DDA0DD' },
    { color: 'rgba(135, 206, 235, 0.4)', glow: '#87CEEB' },
    { color: 'rgba(240, 128, 128, 0.4)', glow: '#F08080' },
    { color: 'rgba(152, 251, 152, 0.4)', glow: '#98FB98' },
    { color: 'rgba(216, 191, 216, 0.4)', glow: '#D8BFD8' },
    { color: 'rgba(255, 218, 185, 0.4)', glow: '#FFDAB9' },
    { color: 'rgba(240, 230, 140, 0.4)', glow: '#F0E68C' }
  ];

  const giftBoxColors = [
    '#e74c3c', '#2ecc71', '#f1c40f', '#e67e22', 
    '#3498db', '#9b59b6', '#ff7979', '#1abc9c',
    '#ff6b81', '#16a085', '#2980b9', '#d63031'
  ];

  const ornamentPositions = [
    { top: '16%', left: '50%' },
    { top: '24%', left: '42%' },
    { top: '26%', left: '58%' },
    { top: '34%', left: '35%' },
    { top: '36%', left: '65%' },
    { top: '40%', left: '50%' },
    { top: '48%', left: '28%' },
    { top: '50%', left: '72%' },
    { top: '54%', left: '40%' },
    { top: '56%', left: '60%' },
    { top: '64%', left: '32%' },
    { top: '66%', left: '68%' }
  ];

  const handleOrnamentClick = (index) => {
    setSelectedOrnament(index);
    setClickedOrnaments(prev => new Set([...prev, index]));
  };

  const closeModal = () => {
    setSelectedOrnament(null);
  };

  const openGallery = () => {
    setShowGallery(true);
    setGalleryViewLetter(null);
  };

  const closeGallery = () => {
    setShowGallery(false);
    setGalleryViewLetter(null);
  };

  const handleSaveImage = async () => {
    if (!letterCardRef.current || !window.html2canvas) return;
    try {
      const canvas = await window.html2canvas(letterCardRef.current, {
        scale: 2,
        backgroundColor: null,
        logging: false,
        useCORS: true
      });
      const image = canvas.toDataURL("image/png");
      const link = document.createElement("a");
      link.href = image;
      link.download = `Letter_for_${userName}.png`;
      link.click();
    } catch (err) {
      console.error("ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨:", err);
      alert("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.");
    }
  };

  const GiftBox = ({ color }) => (
    <div style={{
      position: 'relative', width: '50%', height: '45%', display: 'flex', flexDirection: 'column',
      alignItems: 'center', justifyContent: 'flex-end', filter: 'drop-shadow(0 4px 4px rgba(0,0,0,0.3))'
    }}>
      <div style={{
        position: 'absolute', top: '10%', width: '110%', height: '25%', borderRadius: '4px', zIndex: 3,
        boxShadow: '0 2px 4px rgba(0,0,0,0.2)', background: `linear-gradient(to right, ${color}, white 50%, ${color})`
      }} />
      <div style={{
        position: 'absolute', top: '-15%', width: '40%', height: '25%', display: 'flex', justifyContent: 'center', zIndex: 4
      }}>
        <div style={{ width: '50%', height: '100%', background: '#ffeb3b', borderRadius: '50% 0 0 50%', transform: 'rotate(-10deg)' }} />
        <div style={{ width: '50%', height: '100%', background: '#ffeb3b', borderRadius: '0 50% 50% 0', transform: 'rotate(10deg)' }} />
         <div style={{ position: 'absolute', top: '20%', width: '20%', height: '80%', background: '#fdd835', borderRadius: '2px' }}/>
      </div>
      <div style={{
        width: '100%', height: '75%', background: color, borderRadius: '0 0 4px 4px', position: 'relative',
        boxShadow: 'inset 0 -5px 10px rgba(0,0,0,0.1)'
      }}>
        <div style={{ position: 'absolute', left: '50%', top: '0', transform: 'translateX(-50%)', width: '20%', height: '100%', background: '#ffeb3b' }} />
      </div>
    </div>
  );

  const Snowflake = ({ delay, duration, left, size }) => (
    <div style={{
        position: 'fixed', top: '-20px', left: `${left}%`, fontSize: `${size}px`, color: 'white', opacity: 0.8, pointerEvents: 'none',
        animation: `fall ${duration}s linear infinite`, animationDelay: `${delay}s`, zIndex: 1, textShadow: '0 0 5px rgba(255,255,255,0.8)'
      }}>â„</div>
  );

  return (
    <div style={{
      height: '100vh', width: '100vw',
      backgroundImage: 'linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url(https://i.imgur.com/ccQbw2H.png)', // ë°°ê²½ì„ ì¡°ê¸ˆ ë” ì–´ë‘¡ê²Œ í•˜ì—¬ ê¸€ì ê°€ë…ì„± ë†’ì„
      backgroundSize: 'cover', backgroundPosition: 'center', backgroundRepeat: 'no-repeat',
      overflow: 'hidden', position: 'relative', fontFamily: "'Nanum Myeongjo', serif" // í°íŠ¸ ë³€ê²½
    }}>
      <style>{`
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
        @keyframes swing { 0%, 100% { transform: translateX(-50%) rotate(-3deg); } 50% { transform: translateX(-50%) rotate(3deg); } }
        @keyframes sparkle { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.3; transform: scale(0.8); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
      `}</style>

      <audio ref={audioRef} loop preload="auto" src="https://ik.imagekit.io/foefnjeua/jazz-christmas-432315.mp3" />

      {Array.from({ length: 50 }).map((_, i) => (
        <Snowflake key={i} delay={Math.random() * 5} duration={Math.random() * 10 + 15} left={Math.random() * 100} size={Math.random() * 15 + 10} />
      ))}

      {/* íŒì—… ì œê±°ë¡œ ì¸í•œ ë°”ë¡œê°€ê¸° ë²„íŠ¼ */}
      <>
        <button onClick={toggleMusic} style={{
            position: 'absolute', top: '20px', right: '20px', zIndex: 100,
            background: isMusicPlaying ? 'rgba(255, 255, 255, 0.4)' : 'rgba(0, 0, 0, 0.4)',
            border: '1px solid rgba(255, 255, 255, 0.6)', borderRadius: '50%', width: '40px', height: '40px',
            display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', color: 'white', backdropFilter: 'blur(5px)'
          }}>
          {isMusicPlaying ? 'ğŸ”Š' : 'ğŸ”‡'}
        </button>
        {clickedOrnaments.size > 0 && (
          <button onClick={openGallery} style={{
              position: 'absolute', bottom: '30px', right: '30px', zIndex: 90,
              background: 'rgba(255, 255, 255, 0.2)', backdropFilter: 'blur(10px)', border: '1px solid rgba(255,255,255,0.4)',
              color: 'white', borderRadius: '50px', padding: '10px 20px', fontSize: '1em', cursor: 'pointer',
              display: 'flex', alignItems: 'center', gap: '8px', boxShadow: '0 4px 15px rgba(0,0,0,0.3)'
            }}>
            ğŸ’Œ í¸ì§€í•¨ ì—´ê¸°
          </button>
        )}
      </>

      {/* ì´ë¦„ ì…ë ¥ íŒì—… ì œê±°ë¨ */}

      <div style={{
        position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%',
        padding: '0 10px', boxSizing: 'border-box', filter: (!showGallery) ? 'none' : 'blur(5px)', transition: 'filter 0.5s ease'
      }}>
        <div style={{ flexShrink: 0, marginBottom: '0', textAlign: 'center', zIndex: 40, marginTop: '20px' }}>
          <h1 style={{
            fontSize: 'clamp(1.8em, 4vw, 2.5em)', fontWeight: 700, color: '#f3f4f6',
            textShadow: '0 4px 12px rgba(0, 0, 0, 0.8)', margin: '0 0 10px 0', letterSpacing: '2px'
          }}>
             2026, ìƒˆë¡œìš´ ì‹œì‘
          </h1>
          <p style={{
            fontSize: 'clamp(0.9em, 2vw, 1.1em)', color: 'rgba(255, 255, 255, 0.9)',
            textShadow: '0 2px 4px rgba(0, 0, 0, 0.8)', margin: '0', fontWeight: '400'
          }}>
            ì˜¤ë„ˆë¨¼íŠ¸ë¥¼ ëˆŒëŸ¬ {userName}ê»˜ ë“œë¦¬ëŠ” ì§€í˜œì™€ ì¶•ë³µì„ í™•ì¸í•˜ì„¸ìš”
          </p>
        </div>

        <div style={{
          position: 'relative', height: '80vh', aspectRatio: '0.7', display: 'flex', alignItems: 'flex-end', justifyContent: 'center', marginTop: '-1vh'
        }}>
          {ornamentPositions.map((pos, index) => {
            const style = ornamentStyles[index];
            const isClicked = clickedOrnaments.has(index);
            const boxColor = giftBoxColors[index % giftBoxColors.length];
            if (isClicked) return null;
            return (
              <div key={index} onClick={() => handleOrnamentClick(index)}
                style={{
                  position: 'absolute', top: pos.top, left: pos.left, width: 'clamp(55px, 9vh, 80px)', height: 'clamp(55px, 9vh, 80px)',
                  borderRadius: '50%', cursor: 'pointer', transition: 'all 0.3s ease',
                  display: 'flex', alignItems: 'center', justifyContent: 'center', transform: 'translateX(-50%)', zIndex: 30,
                  animation: `swing 4s ease-in-out infinite ${index * 0.3}s`
                }}
              >
                {/* ì˜¤ë„ˆë¨¼íŠ¸ ë””ìì¸ ìœ ì§€ */}
                 <div style={{
                   width: '100%', height: '100%', borderRadius: '50%',
                   background: `radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9) 0%, ${style.color} 40%, rgba(0,0,0,0.4) 100%)`,
                   boxShadow: `0 0 15px ${style.glow}`
                 }}></div>
                 <div style={{ position: 'absolute', top: '-15%', width: '10%', height: '20%', background: '#b8860b', zIndex: -1 }}></div>
                 <div style={{ position: 'absolute', width: '60%', height: '60%', display: 'flex', justifyContent: 'center', alignItems: 'center' }}>
                    <GiftBox color={boxColor} />
                 </div>
              </div>
            );
          })}
          {/* ì „êµ¬ íš¨ê³¼ */}
          {Array.from({ length: 40 }).map((_, i) => {
            const top = 15 + Math.random() * 65; 
            const widthSpread = (top - 10) * 0.7;
            const left = 50 + (Math.random() * widthSpread - widthSpread/2);
            return <div key={`light-${i}`} style={{
              position: 'absolute', left: `${left}%`, top: `${top}%`, width: '4px', height: '4px',
              borderRadius: '50%', background: '#fff', boxShadow: `0 0 8px #fff`,
              animation: `sparkle ${1.5 + Math.random()}s ease-in-out infinite ${Math.random()}s`, zIndex: 20, opacity: 0.8
            }}/>
          })}
        </div>
      </div>

      {/* ë©”ì‹œì§€ ëª¨ë‹¬ */}
      {selectedOrnament !== null && (
        <div onClick={closeModal} style={{
            position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', background: 'rgba(0, 0, 0, 0.85)', backdropFilter: 'blur(5px)',
            display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 100, padding: '20px'
          }}>
          <div onClick={(e) => e.stopPropagation()} style={{
              position: 'relative', background: '#fffcf5', padding: '40px 30px', borderRadius: '4px', maxWidth: '500px', width: '100%',
              textAlign: 'center', color: '#1a1a1a', boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)',
              animation: 'slideIn 0.5s ease', border: '1px solid #dcdcdc'
            }}>
            <div style={{ fontSize: '2em', marginBottom: '15px', color: '#b8860b' }}>ğŸ</div>
            <h2 style={{ fontSize: '1.4em', fontWeight: 700, marginBottom: '25px', color: '#1a1a1a', borderBottom: '1px solid #eee', paddingBottom: '15px' }}>
              To. {userName}
            </h2>
            <div style={{
                fontSize: '1.15em', lineHeight: '1.8', marginBottom: '30px', color: '#374151',
                whiteSpace: 'pre-line', textAlign: 'left', wordBreak: 'keep-all', padding: '10px'
              }}>
              {principalMessages[selectedOrnament]}
            </div>
            <button onClick={closeModal} style={{
                background: '#1a1a1a', color: 'white', border: 'none', padding: '12px 30px', borderRadius: '0',
                fontSize: '1em', cursor: 'pointer', transition: 'all 0.2s ease', fontFamily: "'Nanum Myeongjo', serif"
              }}>
              ë§ˆìŒì— ìƒˆê¸°ê² ìŠµë‹ˆë‹¤ ğŸ™
            </button>
          </div>
        </div>
      )}

      {/* ê°¤ëŸ¬ë¦¬ ëª¨ë‹¬ */}
      {showGallery && (
        <div style={{
            position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', background: 'rgba(0, 0, 0, 0.95)',
            display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 200, padding: '20px'
          }}>
          {galleryViewLetter === null ? (
            <div style={{
                background: '#fff', padding: '30px', borderRadius: '4px', width: '100%', maxWidth: '600px', maxHeight: '80vh', overflowY: 'auto',
                display: 'flex', flexDirection: 'column', alignItems: 'center'
              }}>
              <h2 style={{ marginBottom: '20px', color: '#1a1a1a', fontFamily: "'Nanum Myeongjo', serif" }}>{userName}ì˜ ì„œì¬</h2>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(120px, 1fr))', gap: '15px', width: '100%' }}>
                {[...clickedOrnaments].map((idx) => (
                  <div key={idx} onClick={() => setGalleryViewLetter(idx)} style={{
                      background: '#f3f4f6', padding: '20px', cursor: 'pointer', textAlign: 'center', border: '1px solid #e5e7eb',
                      transition: 'all 0.2s', fontFamily: "'Nanum Myeongjo', serif"
                    }}
                    onMouseEnter={e => {e.currentTarget.style.background = '#e5e7eb';}}
                    onMouseLeave={e => {e.currentTarget.style.background = '#f3f4f6';}}
                  >
                    <div style={{ fontSize: '1.5em', marginBottom: '5px' }}>ğŸ“œ</div>
                    <span style={{ fontSize: '0.9em', color: '#4b5563' }}>{idx + 1}ë²ˆì§¸ ì§€í˜œ</span>
                  </div>
                ))}
              </div>
              <button onClick={closeGallery} style={{ marginTop: '25px', padding: '10px 30px', border: '1px solid #d1d5db', background: 'white', cursor: 'pointer' }}>
                ë‹«ê¸°
              </button>
            </div>
          ) : (
            <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', width: '100%' }}>
              <div ref={letterCardRef} style={{
                  background: '#fffcf5', padding: '50px', maxWidth: '450px', width: '100%',
                  boxShadow: '0 20px 40px rgba(0,0,0,0.5)', position: 'relative', border: '1px solid #dcdcdc'
                }}>
                <div style={{ position: 'absolute', top: '20px', right: '20px', fontSize: '1.5em', opacity: 0.5 }}>ğŸ</div>
                <h3 style={{ color: '#1a1a1a', marginBottom: '30px', borderBottom: '1px solid #1a1a1a', paddingBottom: '15px', textAlign: 'center', fontFamily: "'Nanum Myeongjo', serif", fontSize: '1.5em' }}>
                  To. {userName}
                </h3>
                <div style={{ whiteSpace: 'pre-line', lineHeight: '2', color: '#374151', fontSize: '1.1em', fontFamily: "'Nanum Myeongjo', serif', textAlign: 'justify'" }}>
                  {principalMessages[galleryViewLetter]}
                </div>
                <div style={{ marginTop: '40px', textAlign: 'right', color: '#6b7280', fontSize: '0.9em', fontStyle: 'italic' }}>
                  2025ë…„ ê²¨ìš¸, êµì¥ì„ ìƒë‹˜ì„ ì¡´ê²½í•˜ëŠ” ë§ˆìŒì„ ë‹´ì•„
                </div>
              </div>
              <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                <button onClick={handleSaveImage} style={{
                    padding: '12px 25px', border: 'none', background: '#1a1a1a', color: 'white', cursor: 'pointer', fontFamily: "'Nanum Myeongjo', serif"
                  }}>
                  ì´ë¯¸ì§€ë¡œ ì €ì¥ ğŸ“¸
                </button>
                <button onClick={() => setGalleryViewLetter(null)} style={{
                    padding: '12px 25px', border: '1px solid #fff', background: 'transparent', color: 'white', cursor: 'pointer', fontFamily: "'Nanum Myeongjo', serif"
                  }}>
                  ëª©ë¡ìœ¼ë¡œ
                </button>
              </div>
            </div>
          )}
        </div>
      )}
    </div>
  );
}
